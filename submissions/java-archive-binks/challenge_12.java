static String u(String[] R, int x, int y, int w, int h){String r="";for(int i=Math.max(0,x);i<x+h && i<R.length;i++){for(int j=Math.max(0,y);j<y+w && j<R[0].length();j++){r+=R[i].charAt(j);}}return r;}static int c(String s, char c){return s.length()-s.replace(c+"","").length();}static void f(String s,int w, int h){String[] R = s.split("\n");int x,y,H,W,d,n=R.length, m=R[0].length();int S = 3 + 20*w + 20*(m+w+1)*h, P=-1;Set<Integer> T = new HashSet<>();while(true){if(T.contains(S)){int out = 8;if(P==S){out = 9;}System.out.print(out);break;}T.add(S);W = S%2;H=(S/2)%2;d=(S/4)%5;y=(S/20)%(m+w+1);x=S/(20*(m+w+1));String o = u(R,x-h,y-w,w,h);if(c(o,'w') > c(o,'W') ){W=0;}if(c(o,'w') < c(o,'W') ){W=1;}if(c(o,'h') > c(o,'H') ){H=0;}if(c(o,'h') < c(o,'H') ){H=1;}if(H==0){o = o.replace(">","").replace("<","");}if(W==0){o = o.replace("^","").replace("v","");}String D = ">^<v";int[] dd = new int[4];for(int i=0;i<4;i++){dd[i] = o.length()-o.replace(D.charAt(i)+"","").length();}int u = dd[1] - dd[3];int r = dd[0] - dd[2];boolean v=false, j=false;if(Math.abs(u) == Math.abs(r) && u!=0){if(d==0 || d == 2){j=true;}if(d==1 || d == 3){v=true;}}d = 4;if(Math.abs(u) > Math.abs(r) || v){if(u>0){d=1;}else{d=3;}}if(Math.abs(u) < Math.abs(r) || j){if(r>0){d=0;}else{d=2;}}x+=d==3?1:(d==1?-1:0);y+=d==0?1:(d==2?-1:0);P=S;S=W+2*H+4*d+20*y+(m+w+1)*20*x;}}
